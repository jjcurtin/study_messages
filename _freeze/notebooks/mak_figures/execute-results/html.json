{
  "hash": "b53b1d7e05f153eee9cabef439681ad0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Make All Figures for Main Manuscript\"\nauthor: \"Kendra Wyant\"\ndate: \"2025-10-03\"\nnumber-sections: true\noutput: \n  html_document:\n    toc: true \n    toc_depth: 4\nformat:\n  html:\n    embed-resources: true\n    toc: true\n    toc-depth: 4\neditor_options: \n  chunk_output_type: console\nexecute:\n  echo: false\nhtml-table-processing: none\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\nsuppressPackageStartupMessages(library(tidyverse))\nsuppressPackageStartupMessages(library(tidymodels))\nsuppressPackageStartupMessages(source(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\"))\n\ntheme_set(theme_classic())\n\npath_models <- format_path(str_c(\"risk/models/messages\"))\n\nmodel_full <- read_rds(here::here(path_models, \"best_model_v17_kfold_full.rds\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nfeat_imp <- model_full |> \n  tidy() |> \n  mutate(estimate = -1 * estimate) |> \n  filter(abs(estimate) > 0) |> \n  filter(term != \"(Intercept)\") |> \n  mutate(term = case_match(term,\n                           \"abstinence_confidence\" ~ \"Abstinence confidence\", \n                           \"abstinence_goal_Yes\" ~ \"Goal of abstinence\",\n                           \"efficacy_neg_affect\" ~ \"Negative affect efficacy\",\n                           \"craving_total\" ~ \"Craving\",\n                           \"demo_income\" ~ \"Income\",\n                           \"demo_sex_Male\" ~ \"Male\",\n                           \"indiv_doa\" ~ \"Individual alcohol counseling\",\n                           .default = term)) |> \n  mutate(term = if_else(str_detect(term, \"cont_type_abr.friend\"), \"Communications with friends\", term),\n         term = if_else(str_detect(term, \".NonDrinker\"), \"Communications with non-drinkers\", term),\n         term = if_else(str_detect(term, \"contact_drink_future\"), \"Communications with people who would drink in their presence\", term),\n         term = if_else(str_detect(term, \".Drinker\"), \"Communications with drinkers\", term),\n         term = if_else(str_detect(term, \".phone_number\"), \"Number of unique contacts\", term))|> \n  group_by(term) |> \n  summarise(estimate = mean(estimate)) |> \n  arrange(desc(abs(estimate))) |> \n  mutate(term = reorder(term, abs(estimate)))  |> \n  ggplot(aes(x = estimate, y = term, fill = estimate > 0)) +\n  geom_col() +\n  scale_fill_manual(values = c(\"TRUE\" = \"tomato\", \"FALSE\" = \"steelblue\")) +\n  labs(\n    x = \"Coefficient\",\n    y = NULL,\n    title = \"Feature Importance\"\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'Matrix'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoaded glmnet 4.1-8\n```\n\n\n:::\n:::\n\n::: {#cell-fig-1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-1\n#| fig-cap: \"Global feature importance (glmnet coefficient) for the full model. Features are ordered by absolute coefficient value. Rate counts of communications with friends, non-drinkers, and drinkers were calculated across varying scoring epochs. Standardized coefficients were averaged across retained epochs to produce single aggregate feature importance score. Blue bars indicate higher feature values on average lower lapse risk. Red bars indicate higher feature values on average increase risk.\"\n#| fig-width: 6\n#| fig-height: 5\n\nfeat_imp \n```\n\n::: {.cell-output-display}\n![Global feature importance (glmnet coefficient) for the full model. Features are ordered by absolute coefficient value. Rate counts of communications with friends, non-drinkers, and drinkers were calculated across varying scoring epochs. Standardized coefficients were averaged across retained epochs to produce single aggregate feature importance score. Blue bars indicate higher feature values on average lower lapse risk. Red bars indicate higher feature values on average increase risk.](mak_figures_files/figure-html/fig-1-1.png){#fig-1 width=576}\n:::\n:::",
    "supporting": [
      "mak_figures_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}