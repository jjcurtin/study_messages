{
  "hash": "f0119bfd239c90cb79dedc72ee4600ed",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Make All Figures for Main Manuscript\"\nauthor: \"Kendra Wyant\"\ndate: \"2025-10-16\"\nnumber-sections: true\noutput: \n  html_document:\n    toc: true \n    toc_depth: 4\nformat:\n  html:\n    embed-resources: true\n    toc: true\n    toc-depth: 4\neditor_options: \n  chunk_output_type: console\nexecute:\n  echo: false\nhtml-table-processing: none\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\nsuppressPackageStartupMessages(library(tidyverse))\nsuppressPackageStartupMessages(library(tidymodels))\nsuppressPackageStartupMessages(source(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\"))\nsuppressPackageStartupMessages(library(patchwork))\n\ntheme_set(theme_classic())\n\npath_models <- format_path(\"risk/models/messages\")\n\nmodel_full <- read_rds(here::here(path_models, \"best_model_v17_kfold_full.rds\"))\n\npp <- read_csv(here::here(path_models, \"posteriors.csv\"),\n                    show_col_types = FALSE)\n\nmodel_base <- read_rds(here::here(path_models, \"best_model_v17_kfold_baseline.rds\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nfeat_imp <- model_full |> \n  tidy() |> \n  mutate(estimate = -1 * estimate) |> \n  filter(abs(estimate) > 0) |> \n  filter(term != \"(Intercept)\") |> \n  mutate(term = case_match(term,\n                           \"abstinence_confidence\" ~ \"Abstinence confidence (baseline)\", \n                           \"abstinence_goal_Yes\" ~ \"Goal of abstinence (baseline)\",\n                           \"efficacy_neg_affect\" ~ \"Negative affect efficacy (baseline)\",\n                           \"craving_total\" ~ \"Craving (baseline)\",\n                           \"demo_income\" ~ \"Income (baseline)\",\n                           \"demo_sex_Male\" ~ \"Male (baseline)\",\n                           \"indiv_doa\" ~ \"Individual alcohol counseling (baseline)\",\n                           .default = term)) |> \n  mutate(term = if_else(str_detect(term, \"cont_type_abr.friend\"), \"Friends (communications)\", term),\n         term = if_else(str_detect(term, \".NonDrinker\"), \"Non-drinkers (communications)\", term),\n         term = if_else(str_detect(term, \".support_status.Dont\"), \"Doesn't know about recovery (communications)\", term),\n         term = if_else(str_detect(term, \".Drinker\"), \"Drinkers (communications)\", term),\n         term = if_else(str_detect(term, \".phone_number\"), \"Number of unique contacts (communications)\", term),\n         term = if_else(str_detect(term, \"experience.Unpleasant\"), \"Unpleasant interactions (communications)\", term))|> \n  group_by(term) |> \n  summarise(estimate = mean(estimate)) |> \n  arrange(desc(abs(estimate))) |> \n  mutate(term = reorder(term, abs(estimate)))  |> \n  ggplot(aes(x = estimate, y = term, fill = estimate > 0)) +\n  geom_col() +\n  scale_fill_manual(values = c(\"TRUE\" = \"tomato\", \"FALSE\" = \"steelblue\")) +\n  labs(\n    x = \"Coefficient\",\n    y = NULL,\n    title = \"Feature Importance\"\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'Matrix'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoaded glmnet 4.1-8\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# pp |> \n#   mutate(model = factor(model, levels = c(\"full model\", \"baseline model\"),\n#                         labels = c(\"Full model\", \"Baseline model\"))) |> \n#   ggplot(aes(x = posterior)) +\n#   geom_histogram(bins = 50, color = \"black\", fill = \"light grey\") +\n#   facet_wrap(~model, ncol = 1)+\n#   geom_vline(xintercept = .5, linetype = \"dashed\") +\n#   geom_vline(xintercept = median(pp$posterior))\n\n# post <- pp |> \n#   filter(model == \"full model\") |> \n#   ggplot(aes(x = posterior)) +\n#   geom_histogram(bins = 30, color = \"black\", fill = \"light grey\") +\n#   geom_vline(xintercept = .5, linetype = \"dashed\") +\n#   geom_vline(xintercept = median(pp$posterior), linewidth = .6)\n```\n:::\n\n::: {#cell-fig-1 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-1\n#| fig-cap: \"Global feature importance (elastic net coefficient) for the full model. Features are ordered by absolute coefficient value. Blue bars indicate higher feature values, on average, lower lapse risk. Red bars indicate higher feature values, on average, increase risk. Baseline features were collected from self-report measures at the start of the study. Communication features were engineered from the contexualized cellular communications.\"\n#| fig-width: 7\n#| fig-height: 5\n\nfeat_imp \n```\n\n::: {.cell-output-display}\n![Global feature importance (elastic net coefficient) for the full model. Features are ordered by absolute coefficient value. Blue bars indicate higher feature values, on average, lower lapse risk. Red bars indicate higher feature values, on average, increase risk. Baseline features were collected from self-report measures at the start of the study. Communication features were engineered from the contexualized cellular communications.](mak_figures_files/figure-html/fig-1-1.png){#fig-1 width=672}\n:::\n:::",
    "supporting": [
      "mak_figures_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}