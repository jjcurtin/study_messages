{
  "hash": "709a5a5db61bdb5a73fe129efaa3f00f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"EDA on Raw Messages\"\nauthor: \"Coco Yu\"\ndate: \"2024-12-03\"\nformat: \n  html:\n    toc: true \n    toc_depth: 4\n    embed-resources: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n## Code Status\n\n## Notes\n\n## Setup\n\nChunk Defaults\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nknitr::opts_chunk$set(attr.output='style=\"max-height: 500px;\"')\n```\n:::\n\n\nConflicts\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\noptions(conflicts.policy = \"depends.ok\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ purrr::%||%()   masks base::%||%()\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(kableExtra, exclude = \"group_rows\")\nlibrary(lubridate)\nlibrary(janitor, include.only = c(\"tabyl\", \"clean_names\"))\nlibrary(here, include.only = c(\"here\"))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at /home/jjcurtin/github/study_messages\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ntheme_set(theme_classic())\n```\n:::\n\n\nSource Functions\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"a58e57da996d1b70bb9a5b58241325d6fd78890f\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/fun_eda.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"c045eee2655a18dc85e715b78182f176327358a7\"\n```\n\n\n:::\n:::\n\n\nAbsolute Paths \n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# path_shared <- format_path(str_c(\"studydata/risk/data_processed/shared\"))\npath_messages <- format_path(str_c(\"studydata/risk/data_processed/messages\"))\n```\n:::\n\n\nRead in Data \n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nraw_data <- read_csv(here(path_messages, \"eda\", \"eda_raw.csv\")) |> glimpse()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nRows: 313492 Columns: 3\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (3): id_obs, subid, text_length\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nRows: 313,492\nColumns: 3\n$ id_obs      <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…\n$ subid       <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…\n$ text_length <dbl> 1, 2, 8, 18, 11, 5, 10, 4, 21, 2, 3, 14, 7, 17, 1, 15, 5, …\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\npred_3day <- read_csv(here(path_messages, \"eda\", \"eda_3day.csv\")) |> glimpse()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nRows: 915833 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (1): lapse\ndbl  (2): id_obs, subid\nlgl  (1): na\ndttm (1): day_start\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nRows: 915,833\nColumns: 5\n$ id_obs    <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…\n$ subid     <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …\n$ day_start <dttm> 2017-03-25 09:00:00, 2017-03-25 09:00:00, 2017-03-25 09:00:…\n$ lapse     <chr> \"no lapse\", \"no lapse\", \"no lapse\", \"no lapse\", \"no lapse\", …\n$ na        <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\npred_1week <- read_csv(here(path_messages, \"eda\", \"eda_1week.csv\")) |> glimpse()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nRows: 2086041 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (1): lapse\ndbl  (2): id_obs, subid\nlgl  (1): na\ndttm (1): day_start\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nRows: 2,086,041\nColumns: 5\n$ id_obs    <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…\n$ subid     <dbl> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …\n$ day_start <dttm> 2017-03-25 09:00:00, 2017-03-25 09:00:00, 2017-03-25 09:00:…\n$ lapse     <chr> \"no lapse\", \"no lapse\", \"no lapse\", \"no lapse\", \"no lapse\", …\n$ na        <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlabels <- read_csv(here(path_messages, \"lapses.csv\"), col_types = cols()) |> \n  mutate(day_start = as_datetime(day_start, tz = \"America/Chicago\"),\n         day_end = as_datetime(day_end, tz = \"America/Chicago\"))\n```\n:::\n\n\n## EDA on lapse labels\n\n\n::: {#cell-fig-lapse_count .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-lapse_count\n#| fig-cap: \"Distribution of Lapse Label Counts\"\n\nlabels |> \n  group_by(subid) |> \n  summarize(n = n()) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(fill = \"#97C4C5\", bins = 70) +\n  labs(y = \"subject counts\", x = \"# of lapses\")\n```\n\n::: {.cell-output-display}\n![Distribution of Lapse Label Counts](fig_eda_messages_files/figure-html/fig-lapse_count-1.png){#fig-lapse_count width=672}\n:::\n:::\n\n\n## EDA on raw messages\n\n### Message counts per participant\n\n**Histogram on # of messages per participant**\n\n::: {#cell-fig-message_count .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-message_count\n#| fig-cap: \"Distribution of Message Counts\"\n#| fig-width: 3.5\n#| fig-height: 2.5\nplt1_raw <- raw_data |> \n  group_by(subid) |> \n  summarize(n = n()) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(bins = 50, fill = \"#97C4C5\") +\n  labs(x = \"# of messages\", y = \"subject counts\",\n       caption = str_wrap(\"(a) Distribution of Message Counts by Subject\", \n                          width = 70)) +\n  theme(plot.caption = element_text(hjust = 0.5))\n```\n:::\n\n\n### Message Length per participant\n\n**Histogram on mean/median message length per participant**\n\n::: {#cell-fig-message_length .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-message_length\n#| fig-cap: \"Distribution of Mean Message Length\"\n#| fig-width: 3.5\n#| fig-height: 2.5\nplt2_raw <- raw_data |> \n  group_by(subid) |> \n  summarize(mean_length = mean(text_length)) |> \n  ggplot(aes(x = mean_length)) + \n  geom_histogram(binwidth = 1, fill = \"#97C4C5\") +\n  labs(x = \"mean message length\", y = \"subject counts\", \n       caption = str_wrap(\"(b) Distribution of Mean Message Length by Subject\"),\n       width = 70) +\n  theme(plot.caption = element_text(hjust = 0.5))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nraw_data |> \n  group_by(subid) |> \n  summarize(median_length = median(text_length)) |> \n  ggplot(aes(x = median_length)) + \n  geom_histogram(binwidth = 1, fill = \"#97C4C5\") +\n  labs(x = \"median message length\", y = \"subject counts\")\n```\n\n::: {.cell-output-display}\n![](fig_eda_messages_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {#cell-fig-raw .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-raw\n#| fig-cap: \"Sample Characteristics of Raw Messages\"\n\nggpubr::ggarrange(plt1_raw, plt2_raw)\n```\n\n::: {.cell-output-display}\n![Sample Characteristics of Raw Messages](fig_eda_messages_files/figure-html/fig-raw-1.png){#fig-raw width=672}\n:::\n:::\n\n\n## EDA on prediction windows\n\n### prediction window: 3-day\n\n**Distribution by label**\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplt1_3day <- pred_3day |> \n  group_by(subid, day_start) |> \n  summarize(n = n()) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(fill = \"#97C4C5\") +\n  labs(x = \"# of messages\", y = \"lapse counts\", \n       caption = str_wrap(\"(a) Distribution of Message Counts\"), width = 70) +\n  theme(plot.caption = element_text(hjust = 0.5)) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'subid'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n\n**Distribution by participant**\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplt2_3day <- pred_3day |> \n  group_by(subid, day_start) |> \n  summarize(\n    n_messages = sum(!na)\n  ) |> \n  group_by(subid) |> \n  summarize(\n    mean_messages = mean(n_messages)\n  ) |>\n  ggplot(aes(x = mean_messages)) +\n  geom_histogram(fill = \"#97C4C5\") +\n  labs(x = \"average # of messages per label\", y = \"subject counts\",\n       caption = str_wrap(\"(b) Distribution of Message Counts by Subject\",\n                          width = 70)) +\n  theme(plot.caption = element_text(hjust = 0.5)) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'subid'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplt3_3day <- pred_3day |> \n  group_by(subid, day_start) |> \n  summarize(\n    missingness = sum(na) / n()\n  ) |> \n  group_by(subid) |> \n  summarize(\n    mean_missing = mean(missingness)\n  ) |> \n  ggplot(aes(x = mean_missing)) +\n  geom_histogram(fill = \"#97C4C5\") +\n  labs(x = \"percentage of missingness\", y = \"subject counts\",\n       caption = str_wrap(\"(c) Distribution of Missingness by Subject\", \n                          width = 70)) +\n  theme(plot.caption = element_text(hjust = 0.5)) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'subid'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {#cell-fig-3day .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-3day\n#| fig-cap: \"Sample Characteristics in the 3-Day Prediction Window\"\nggpubr::ggarrange(\n  ggpubr::ggarrange(NULL, plt1_3day, NULL, ncol = 3, widths = c(1, 1, 1)), \n  ggpubr::ggarrange(plt2_3day, plt3_3day, ncol = 2, nrow = 1),  \n  nrow = 2, ncol = 1, heights = c(1, 1) \n)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Sample Characteristics in the 3-Day Prediction Window](fig_eda_messages_files/figure-html/fig-3day-1.png){#fig-3day width=672}\n:::\n:::\n\n\n### prediction window: 1 week\n\n**Distribution by label**\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplt1_1week <- pred_1week |> \n  group_by(subid, day_start) |> \n  summarize(n = n()) |> \n  ggplot(aes(x = n)) + \n  geom_histogram(fill = \"#97C4C5\") +\n  labs(x = \"# of messages\", y = \"lapse counts\", \n       caption = str_wrap(\"(a) Distribution of Message Counts\"), width = 70) +\n  theme(plot.caption = element_text(hjust = 0.5)) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'subid'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplt2_1week <- pred_1week |> \n  group_by(subid, day_start) |> \n  summarize(\n    n_messages = sum(!na)\n  ) |> \n  group_by(subid) |> \n  summarize(\n    mean_messages = mean(n_messages)\n  ) |>\n  ggplot(aes(x = mean_messages)) +\n  geom_histogram(fill = \"#97C4C5\") +\n  labs(x = \"average # of messages per label\", y = \"subject counts\",\n       caption = str_wrap(\"(b) Distribution of Message Counts by Subject\",\n                          width = 70)) +\n  theme(plot.caption = element_text(hjust = 0.5)) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'subid'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplt3_1week <- pred_1week |> \n  group_by(subid, day_start) |> \n  summarize(\n    missingness = sum(na) / n()\n  ) |> \n  group_by(subid) |> \n  summarize(\n    mean_missing = mean(missingness)\n  ) |> \n  ggplot(aes(x = mean_missing)) +\n  geom_histogram(fill = \"#97C4C5\") +\n  labs(x = \"percentage of missingness\", y = \"subject counts\",\n       caption = str_wrap(\"(c) Distribution of Missingness by Subject\", \n                          width = 70)) +\n  theme(plot.caption = element_text(hjust = 0.5)) \n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'subid'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {#cell-fig-1week .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-1week\n#| fig-cap: \"Sample Characteristics in the 1-Week Prediction Window\"\nggpubr::ggarrange(\n  ggpubr::ggarrange(NULL, plt1_1week, NULL, ncol = 3, widths = c(1, 1, 1)), \n  ggpubr::ggarrange(plt2_1week, plt3_1week, ncol = 2, nrow = 1),  \n  nrow = 2, ncol = 1, heights = c(1, 1) \n)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Sample Characteristics in the 1-Week Prediction Window](fig_eda_messages_files/figure-html/fig-1week-1.png){#fig-1week width=672}\n:::\n:::",
    "supporting": [
      "fig_eda_messages_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}