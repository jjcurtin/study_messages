{
  "hash": "42748382e4058a58def45c9aa2cea981",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"EDA on Subject Demographics\"\nauthor: \"Coco Yu\"\ndate: \"2024-12-11\"\nformat: \n  html:\n    toc: true \n    toc_depth: 4\n    embed-resources: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n## Code Status\n\n## Notes\n\n## Setup\n\nChunk Defaults\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nknitr::opts_chunk$set(attr.output='style=\"max-height: 500px;\"')\n```\n:::\n\n\n\nConflicts\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\noptions(conflicts.policy = \"depends.ok\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.3     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(kableExtra, exclude = \"group_rows\")\nlibrary(lubridate)\nlibrary(janitor, include.only = c(\"tabyl\", \"clean_names\"))\nlibrary(here, include.only = c(\"here\"))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at /Users/yujiachen/Desktop/github/study_messages\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ntheme_set(theme_classic())\n```\n:::\n\n\n\nSource Functions\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"a58e57da996d1b70bb9a5b58241325d6fd78890f\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/fun_eda.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"c045eee2655a18dc85e715b78182f176327358a7\"\n```\n\n\n:::\n:::\n\n\n\nAbsolute Paths \n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\npath_messages <- format_path(str_c(\"studydata/risk/data_processed/messages\"))\npath_shared <- format_path(str_c(\"studydata/risk/data_processed/shared\"))\n```\n:::\n\n\n\n## Prepare Data\n\nRead in Data\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlabels <- read_csv(here(path_messages, \"lapses.csv\"), col_types = cols()) |> \n  mutate(day_start = as_datetime(day_start, tz = \"America/Chicago\"),\n         day_end = as_datetime(day_end, tz = \"America/Chicago\"))\n\nscreen <- read_csv(here::here(path_shared, \"screen.csv\"),\n                   col_types = cols()) |>\n  select(c(starts_with(\"dem\"), subid)) |> \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nRows: 208\nColumns: 16\n$ dem_1   <dbl> 57, 35, 22, 39, 22, 38, 22, 38, 25, 45, 63, 50, 53, 26, 52, 54…\n$ dem_2   <chr> \"Male\", \"Female\", \"Female\", \"Male\", \"Male\", \"Male\", \"Female\", …\n$ dem_3   <chr> \"White/Caucasian\", \"White/Caucasian\", \"White/Caucasian\", \"Whit…\n$ dem_3_1 <chr> NA, NA, NA, NA, NA, NA, NA, NA, \"Filipino and Black\", NA, NA, …\n$ dem_4   <chr> \"No, I am not of Hispanic, Latino, or Spanish origin\", \"No, I …\n$ dem_4_1 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ dem_5   <chr> \"College degree\", \"2-Year degree\", \"High school or GED\", \"Coll…\n$ dem_6   <chr> \"Unemployed\", \"Employed\", \"Employed\", \"Employed\", \"Employed\", …\n$ dem_6_1 <chr> NA, \"Full-time\", \"Full-time\", \"Full-time\", \"Part-time\", \"Full-…\n$ dem_7   <dbl> 12000, 36920, 20064, 130000, 5000, 70000, 8000, 57000, 10000, …\n$ dem_8   <chr> \"Never Married\", \"Never Married\", \"Never Married\", \"Married\", …\n$ dem2_2  <dbl> 2, 2, 4, 1, 2, 1, 4, 2, 2, 2, 0, 2, 3, 2, 1, 0, 2, 2, 2, 1, 2,…\n$ dem2_4  <dbl> 0, 1, 0, 1, NA, 1, 0, 0, 0, 0, 2, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0…\n$ dem2_6  <dbl> 0, 4, 0, 2, NA, NA, 0, 2, 0, 2, 1, 2, 0, 0, 1, 0, 0, 0, 2, 0, …\n$ dem2_8  <dbl> 0, 0, 0, NA, NA, NA, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ subid   <dbl> 1, 2, 3, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16, 17, 9, 18, 19…\n```\n\n\n:::\n:::\n\n\n\nMerge dataframes\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndemographics <- labels |> \n  left_join(screen, by = \"subid\") |> \n  select(-day_start, -day_end, -lapse) |> \n  distinct()\n```\n:::\n\n\n\nClean up -- rename columns and make binary\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndemographics <- demographics |>\n  mutate(\n    race = case_when(\n      dem_3 == \"White/Caucasian\" & grepl(\"No\", dem_4) ~ \"white\",\n      dem_3 != \"White/Caucasian\" | grepl(\"Yes\", dem_4) ~ \"non_white\"),\n    sex = if_else(dem_2 == \"Female\", \"female\", \"male\"),\n    age = if_else(dem_1 >= 55, \"older\", \"younger\"),\n    income = if_else(dem_7 <= .5 * 30000, \"below_poverty\", \"above_poverty\")\n  ) |> \n  select(-starts_with(\"dem\")) |> \n  glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nRows: 138\nColumns: 5\n$ subid  <dbl> 2, 3, 5, 6, 7, 10, 11, 15, 16, 18, 19, 20, 21, 23, 25, 26, 27, …\n$ race   <chr> \"white\", \"white\", \"white\", \"white\", \"white\", \"white\", \"non_whit…\n$ sex    <chr> \"female\", \"female\", \"male\", \"male\", \"male\", \"female\", \"male\", \"…\n$ age    <chr> \"younger\", \"younger\", \"younger\", \"younger\", \"younger\", \"younger…\n$ income <chr> \"above_poverty\", \"above_poverty\", \"above_poverty\", \"below_pover…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\noutput <- rbind(\n  data.frame(table(demographics$sex)),\n  data.frame(table(demographics$race)),\n  data.frame(table(demographics$income)),\n  data.frame(table(demographics$age))\n)\n\noutput$demographics <- rep(c(\"sex\", \"race\", \"income\", \"age\"), each = 2)\noutput <- output |> \n  rename(subgroup = Var1, N = Freq) |> \n  relocate(demographics)\noutput <- output[c(2, 1, 4, 3, 5, 6, 8, 7),]\noutput |> mutate(percent = N / 138) |> print_kbl()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; \"><table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;\">   </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> demographics </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> subgroup </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> N </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> percent </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:right;\"> sex </td>\n   <td style=\"text-align:right;\"> male </td>\n   <td style=\"text-align:right;\"> 65 </td>\n   <td style=\"text-align:right;\"> 0.47 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:right;\"> sex </td>\n   <td style=\"text-align:right;\"> female </td>\n   <td style=\"text-align:right;\"> 73 </td>\n   <td style=\"text-align:right;\"> 0.53 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:right;\"> race </td>\n   <td style=\"text-align:right;\"> white </td>\n   <td style=\"text-align:right;\"> 121 </td>\n   <td style=\"text-align:right;\"> 0.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:right;\"> race </td>\n   <td style=\"text-align:right;\"> non_white </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 0.12 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:right;\"> income </td>\n   <td style=\"text-align:right;\"> above_poverty </td>\n   <td style=\"text-align:right;\"> 99 </td>\n   <td style=\"text-align:right;\"> 0.72 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 6 </td>\n   <td style=\"text-align:right;\"> income </td>\n   <td style=\"text-align:right;\"> below_poverty </td>\n   <td style=\"text-align:right;\"> 39 </td>\n   <td style=\"text-align:right;\"> 0.28 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 8 </td>\n   <td style=\"text-align:right;\"> age </td>\n   <td style=\"text-align:right;\"> younger </td>\n   <td style=\"text-align:right;\"> 125 </td>\n   <td style=\"text-align:right;\"> 0.91 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 7 </td>\n   <td style=\"text-align:right;\"> age </td>\n   <td style=\"text-align:right;\"> older </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 0.09 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n::: {#cell-fig-demographics .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-demographics\n#| fig-cap: \"Demographic Distribution\"\n#| fig-width: 10\noutput |> \n  mutate(\n    subgroup = case_when(\n      subgroup == \"female\" ~ \"unprivileged\",\n      subgroup == \"male\" ~ \"privileged\",\n      subgroup == \"white\" ~ \"privileged\",\n      subgroup == \"non_white\" ~ \"unprivileged\",\n      subgroup == \"above_poverty\" ~ \"privileged\",\n      subgroup == \"below_poverty\" ~ \"unprivileged\",\n      subgroup == \"younger\" ~ \"privileged\",\n      subgroup == \"older\" ~ \"unprivileged\"\n    ),\n    demographics = case_when(\n      demographics == \"sex\" ~ \"Sex\",\n      demographics == \"race\" ~ \"Race\",\n      demographics == \"income\" ~ \"Income\",\n      demographics == \"age\" ~ \"Age\"\n    )\n  ) |> \n ggplot(aes(x = \"\", y = N, fill = subgroup)) + \n  geom_bar(stat=\"identity\", width=1) +\n  coord_polar(\"y\", start=0) +\n  scale_fill_manual(values = c(\"privileged\" = \"#B5D66E\",\n                               \"unprivileged\" = \"#F28072\")) +\n  geom_text(aes(label = c(\n    \"Male\",\n    \"Female\",\n    \"White\",\n    \"Person of Color\",\n    \"Above Poverty\",\n    \"Below Poverty\",\n    \"Younger\",\n    \"Older (>55)\"\n  )), position = position_stack(vjust = 0.5)) +\n  theme_void() +\n  theme(legend.title=element_blank(), legend.position = \"bottom\") +\n  facet_wrap(~factor(demographics, levels = c(\"Race\", \"Sex\", \"Income\", \"Age\"))) +\n  theme(strip.text.x = element_text(size = 16, face=\"bold\")) \n```\n\n::: {.cell-output-display}\n![Demographic Distribution](fig_demographics_files/figure-html/fig-demographics-1.png){#fig-demographics width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndata <- labels |> \n  left_join(demographics, by = \"subid\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndata |> tabyl(sex, lapse)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n    sex lapse no lapse\n female   507     5607\n   male   375     5073\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> tabyl(race, lapse)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n      race lapse no lapse\n non_white    99     1346\n     white   783     9334\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> tabyl(age, lapse) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n     age lapse no lapse\n   older   130     1007\n younger   752     9673\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> tabyl(income, lapse)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n        income lapse no lapse\n above_poverty   607     7737\n below_poverty   275     2943\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(lapse, sex) |> \n  summarize(\n    n = n(),\n    perc = n() / nrow(data)\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'lapse'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 4 × 4\n# Groups:   lapse [2]\n  lapse    sex        n   perc\n  <chr>    <chr>  <int>  <dbl>\n1 lapse    female   507 0.0439\n2 lapse    male     375 0.0324\n3 no lapse female  5607 0.485 \n4 no lapse male    5073 0.439 \n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(lapse, race) |> \n  summarize(\n    n = n(),\n    perc = n() / nrow(data)\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'lapse'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 4 × 4\n# Groups:   lapse [2]\n  lapse    race          n    perc\n  <chr>    <chr>     <int>   <dbl>\n1 lapse    non_white    99 0.00856\n2 lapse    white       783 0.0677 \n3 no lapse non_white  1346 0.116  \n4 no lapse white      9334 0.807  \n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(lapse, age) |> \n  summarize(\n    n = n(),\n    perc = n() / nrow(data)\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'lapse'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 4 × 4\n# Groups:   lapse [2]\n  lapse    age         n   perc\n  <chr>    <chr>   <int>  <dbl>\n1 lapse    older     130 0.0112\n2 lapse    younger   752 0.0650\n3 no lapse older    1007 0.0871\n4 no lapse younger  9673 0.837 \n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(lapse, income) |> \n  summarize(\n    n = n(),\n    perc = n() / nrow(data)\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'lapse'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 4 × 4\n# Groups:   lapse [2]\n  lapse    income            n   perc\n  <chr>    <chr>         <int>  <dbl>\n1 lapse    above_poverty   607 0.0525\n2 lapse    below_poverty   275 0.0238\n3 no lapse above_poverty  7737 0.669 \n4 no lapse below_poverty  2943 0.255 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(sex) |> \n  summarize(\n    lapse = sum(lapse == \"lapse\") / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 2 × 2\n  sex     lapse\n  <chr>   <dbl>\n1 female 0.0829\n2 male   0.0688\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(race) |> \n  summarize(\n    lapse = sum(lapse == \"lapse\") / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 2 × 2\n  race       lapse\n  <chr>      <dbl>\n1 non_white 0.0685\n2 white     0.0774\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(age) |> \n  summarize(\n    lapse = sum(lapse == \"lapse\") / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 2 × 2\n  age      lapse\n  <chr>    <dbl>\n1 older   0.114 \n2 younger 0.0721\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ndata |> \n  group_by(income) |> \n  summarize(\n    lapse = sum(lapse == \"lapse\") / n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 2 × 2\n  income         lapse\n  <chr>          <dbl>\n1 above_poverty 0.0727\n2 below_poverty 0.0855\n```\n\n\n:::\n:::\n",
    "supporting": [
      "fig_demographics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}